<div class="egresos-container">
  <!-- Header simple y elegante -->
  <div class="header">
    <div class="header-content">
      <div class="title-section">
        <h1>ðŸ’¸ Egresos del Taller</h1>
        <p>Resumen semanal de gastos</p>
      </div>
      <button mat-raised-button color="primary" (click)="refreshData()" [disabled]="loading" class="refresh-btn">
        <mat-icon>refresh</mat-icon>
        Actualizar
      </button>
    </div>
  </div>

  <!-- Estado de carga -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="60"></mat-spinner>
    <p>Cargando datos...</p>
  </div>

  <!-- Estado de error -->
  <div *ngIf="error && !loading" class="error-container">
    <mat-icon>error_outline</mat-icon>
    <h3>Error al cargar los datos</h3>
    <p>No se pudieron cargar los datos de egresos.</p>
    <button mat-raised-button color="primary" (click)="refreshData()">
      <mat-icon>refresh</mat-icon>
      Reintentar
    </button>
  </div>

  <!-- Contenido principal -->
  <div *ngIf="!loading && !error && historial" class="main-content">
    
    <!-- Semana actual -->
    <div class="current-week-section" *ngIf="semanaSeleccionada">
      <div class="section-header">
        <h3>ðŸ“… Semana Actual</h3>
        <span class="week-info">{{ getFormattedDateRange(semanaSeleccionada.fechaInicio, semanaSeleccionada.fechaFin) }}</span>
      </div>
      
      <div class="week-stats">
        <div class="stat-item">
          <span class="stat-value">${{ semanaSeleccionada.totalEgresos | number:'1.0-0' }}</span>
          <span class="stat-label">Egresos</span>
        </div>
        <div class="stat-item">
          <span class="stat-value">{{ semanaSeleccionada.cantidadEgresos }}</span>
          <span class="stat-label">Gastos</span>
        </div>
        <div class="stat-item">
          <span class="stat-value">${{ semanaSeleccionada.promedioPorEgreso | number:'1.0-0' }}</span>
          <span class="stat-label">Promedio</span>
        </div>
      </div>

      <!-- Tabla de egresos -->
      <div class="table-container">
        <h4>Egresos de esta semana</h4>
        <table class="egresos-table">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Concepto</th>
              <th>CategorÃ­a</th>
              <th>Responsable</th>
              <th>Monto</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let egreso of egresosFiltrados">
              <td>{{ formatDate(egreso.fechaEgreso) }}</td>
              <td>{{ egreso.concepto }}</td>
              <td>{{ egreso.categoria }}</td>
              <td>{{ egreso.responsable }}</td>
              <td class="amount">${{ egreso.monto | number:'1.0-0' }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Historial de semanas -->
    <div class="history-section">
      <h3>ðŸ“ˆ Historial por PerÃ­odos</h3>
      <div class="weeks-grid">
        <div class="week-card" *ngFor="let semana of historial.semanas" 
             (click)="seleccionarSemana(semana)"
             [class.selected]="semanaSeleccionada?.semana === semana.semana">
          <div class="week-header">
            <h4>{{ getFormattedSemana(semana.semana) }}</h4>
            <span class="week-dates">{{ getFormattedDateRange(semana.fechaInicio, semana.fechaFin) }}</span>
          </div>
          <div class="week-amount">
            <span class="amount-value">${{ semana.totalEgresos | number:'1.0-0' }}</span>
            <span class="egresos-count">{{ semana.cantidadEgresos }} egresos</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
